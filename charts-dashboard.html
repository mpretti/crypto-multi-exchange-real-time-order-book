<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Real-Time Charts Dashboard</title>
    <link rel="stylesheet" href="charts-dashboard.css">
    <script src="https://unpkg.com/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>
    <script>
        // Debug LightweightCharts loading
        window.addEventListener('load', function() {
            console.log('Window loaded, checking LightweightCharts:', {
                typeof: typeof LightweightCharts,
                available: typeof LightweightCharts !== 'undefined',
                hasCreateChart: typeof LightweightCharts !== 'undefined' ? typeof LightweightCharts.createChart : 'undefined'
            });
        });
    </script>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="header-top-row">
                <h1>🚀 Advanced Charts Dashboard</h1>
                <nav class="navigation">
                    <a href="index.html" class="nav-link">← Order Book</a>
                    <a href="charts-dashboard.html" class="nav-link active">Charts</a>
                    <a href="volume-dashboard.html" class="nav-link">Volume Dashboard</a>
                    <a href="exchange-status.html" class="nav-link">Exchange Status</a>
                    <a href="trading-pairs-explorer.html" class="nav-link">Trading Pairs →</a>
                </nav>
            </div>
            
            <!-- Enhanced Controls Panel -->
            <div class="controls-panel">
                <div class="controls-row">
                    <div class="asset-selector">
                        <label for="asset-select">Asset:</label>
                        <select id="asset-select">
                            <option value="BTCUSDT">🪙 BTC/USDT</option>
                            <option value="ETHUSDT">⟠ ETH/USDT</option>
                            <option value="BNBUSDT">🟡 BNB/USDT</option>
                            <option value="ADAUSDT">🔵 ADA/USDT</option>
                            <option value="SOLUSDT">🟣 SOL/USDT</option>
                            <option value="XRPUSDT">💧 XRP/USDT</option>
                            <option value="DOTUSDT">🔴 DOT/USDT</option>
                            <option value="LINKUSDT">🔗 LINK/USDT</option>
                            <option value="MATICUSDT">🟪 MATIC/USDT</option>
                            <option value="LTCUSDT">🥈 LTC/USDT</option>
                        </select>
                    </div>
                    
                    <div class="exchange-selector">
                        <label for="exchange-select">Primary Exchange:</label>
                        <select id="exchange-select">
                            <option value="binance" selected>🟡 Binance ✅</option>
                            <option value="bybit">🟠 Bybit ✅</option>
                            <option value="okx">🔵 OKX ✅</option>
                            <option value="kraken" disabled>🟣 Kraken ❌ (CORS)</option>
                            <option value="bitget" disabled>🟢 Bitget ❌ (API Issues)</option>
                            <option value="coinbase" disabled>🔵 Coinbase ❌ (API Issues)</option>
                            <option value="gemini" disabled>🔷 Gemini ❌ (No Candle API)</option>
                            <option value="bitrue" disabled>🟤 Bitrue ❌ (CORS)</option>
                        </select>
                    </div>
                    
                    <div class="chart-mode-selector">
                        <label for="chart-mode">Chart Mode:</label>
                        <select id="chart-mode">
                            <option value="dual" selected>📊 Dual Charts</option>
                            <option value="single">📈 Single Chart</option>
                            <option value="quad">📱 Quad View</option>
                            <option value="comparison">⚖️ Multi-Exchange</option>
                        </select>
                    </div>
                </div>
                
                <div class="controls-row">
                    <div class="overlay-controls">
                        <label class="overlay-toggle">
                            <input type="checkbox" id="overlay-mode">
                            <span>📈 Overlay Mode</span>
                        </label>
                        <div class="overlay-exchanges" id="overlay-exchanges" style="display: none;">
                            <label><input type="checkbox" value="binance" checked> 🟡 Binance ✅</label>
                            <label><input type="checkbox" value="bybit"> 🟠 Bybit ✅</label>
                            <label><input type="checkbox" value="okx"> 🔵 OKX ✅</label>
                            <label><input type="checkbox" value="kraken" disabled> 🟣 Kraken ❌</label>
                            <label><input type="checkbox" value="bitget" disabled> 🟢 Bitget ❌</label>
                            <label><input type="checkbox" value="coinbase" disabled> 🔵 Coinbase ❌</label>
                            <label><input type="checkbox" value="gemini" disabled> 🔷 Gemini ❌</label>
                            <label><input type="checkbox" value="bitrue" disabled> 🟤 Bitrue ❌</label>
                        </div>
                    </div>
                    
                    <div class="analysis-tools">
                        <button class="tool-btn" id="analysis-btn">📊 Analysis</button>
                        <button class="tool-btn" id="alerts-btn">🔔 Alerts</button>
                        <button class="tool-btn" id="export-btn">💾 Export</button>
                        <button class="tool-btn" id="settings-btn">⚙️ Settings</button>
                        <button id="fullscreen-btn" class="tool-btn" title="Fullscreen">⛶</button>
                    </div>
                </div>
                <div id="preferences-status" class="preferences-status">💾</div>
            </div>
        </header>

        <!-- Market Overview Strip -->
        <div class="market-overview">
            <div class="market-stats">
                <div class="stat-item">
                    <span class="stat-label">24h Volume:</span>
                    <span class="stat-value" id="market-volume">Loading...</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Market Cap:</span>
                    <span class="stat-value" id="market-cap">Loading...</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Fear & Greed:</span>
                    <span class="stat-value" id="fear-greed">Loading...</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Dominance:</span>
                    <span class="stat-value" id="btc-dominance">Loading...</span>
                </div>
            </div>
        </div>

        <div class="status-notice">
            <div class="notice-content">
                <strong>📊 Exchange Status:</strong>
                <span class="working">✅ Working: Binance, Bybit, OKX</span>
                <span class="issues">❌ Issues: Kraken, Bitget, Coinbase, Gemini, Bitrue (CORS/API limitations)</span>
            </div>
        </div>

        <main class="main-content">
            <!-- Side Panel for Tools -->
            <aside class="side-panel" id="side-panel" style="display: none;">
                <div class="panel-header">
                    <h3 id="panel-title">Technical Analysis</h3>
                    <button class="panel-close" id="panel-close">✕</button>
                </div>
                <div class="panel-content" id="panel-content">
                    <!-- Dynamic content will be loaded here -->
                </div>
            </aside>

            <!-- Charts Container -->
            <div class="charts-container" id="charts-container">
                <div class="charts-grid" id="charts-grid">
                    <!-- Chart 1 -->
                    <div class="chart-section" id="chart1-section">
                        <div class="chart-header">
                            <div class="chart-title-group">
                                <h2 id="chart1-title">BTC/USDT - 1 Minute</h2>
                                <div class="timeframe-selector">
                                    <select id="timeframe1-select" class="timeframe-select">
                                        <option value="1m" selected>1m</option>
                                        <option value="3m">3m</option>
                                        <option value="5m">5m</option>
                                        <option value="15m">15m</option>
                                        <option value="30m">30m</option>
                                        <option value="1h">1h</option>
                                        <option value="2h">2h</option>
                                        <option value="4h">4h</option>
                                        <option value="6h">6h</option>
                                        <option value="8h">8h</option>
                                        <option value="12h">12h</option>
                                        <option value="1d">1d</option>
                                        <option value="3d">3d</option>
                                        <option value="1w">1w</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-controls">
                                <div class="indicator-toggles">
                                    <button class="indicator-btn" data-indicator="volume" data-chart="1">📊</button>
                                    <button class="indicator-btn" data-indicator="ma" data-chart="1">📈</button>
                                    <button class="indicator-btn" data-indicator="bollinger" data-chart="1">📊</button>
                                    <button class="indicator-btn" data-indicator="rsi" data-chart="1">📊</button>
                                    <button class="indicator-btn" data-indicator="macd" data-chart="1">📊</button>
                                </div>
                                <div class="chart-stats">
                                    <span class="price" id="price1">Loading...</span>
                                    <span class="change" id="change1">-</span>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container" id="chart1-container"></div>
                        <div class="chart-info">
                            <div class="info-row">
                                <div class="info-item">
                                    <span class="label">Open:</span>
                                    <span class="value" id="open1">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">High:</span>
                                    <span class="value" id="high1">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Low:</span>
                                    <span class="value" id="low1">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Volume:</span>
                                    <span class="value" id="volume1">-</span>
                                </div>
                            </div>
                            <div class="info-row">
                                <div class="info-item">
                                    <span class="label">RSI:</span>
                                    <span class="value" id="rsi1">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">MACD:</span>
                                    <span class="value" id="macd1">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">BB%:</span>
                                    <span class="value" id="bb1">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Volatility:</span>
                                    <span class="value" id="volatility1">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chart 2 -->
                    <div class="chart-section" id="chart2-section">
                        <div class="chart-header">
                            <div class="chart-title-group">
                                <h2 id="chart2-title">BTC/USDT - 5 Minutes</h2>
                                <div class="timeframe-selector">
                                    <select id="timeframe2-select" class="timeframe-select">
                                        <option value="1m">1m</option>
                                        <option value="3m">3m</option>
                                        <option value="5m" selected>5m</option>
                                        <option value="15m">15m</option>
                                        <option value="30m">30m</option>
                                        <option value="1h">1h</option>
                                        <option value="2h">2h</option>
                                        <option value="4h">4h</option>
                                        <option value="6h">6h</option>
                                        <option value="8h">8h</option>
                                        <option value="12h">12h</option>
                                        <option value="1d">1d</option>
                                        <option value="3d">3d</option>
                                        <option value="1w">1w</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-controls">
                                <div class="indicator-toggles">
                                    <button class="indicator-btn" data-indicator="volume" data-chart="2">📊</button>
                                    <button class="indicator-btn" data-indicator="ma" data-chart="2">📈</button>
                                    <button class="indicator-btn" data-indicator="bollinger" data-chart="2">📊</button>
                                    <button class="indicator-btn" data-indicator="rsi" data-chart="2">📊</button>
                                    <button class="indicator-btn" data-indicator="macd" data-chart="2">📊</button>
                                </div>
                                <div class="chart-stats">
                                    <span class="price" id="price2">Loading...</span>
                                    <span class="change" id="change2">-</span>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container" id="chart2-container"></div>
                        <div class="chart-info">
                            <div class="info-row">
                                <div class="info-item">
                                    <span class="label">Open:</span>
                                    <span class="value" id="open2">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">High:</span>
                                    <span class="value" id="high2">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Low:</span>
                                    <span class="value" id="low2">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Volume:</span>
                                    <span class="value" id="volume2">-</span>
                                </div>
                            </div>
                            <div class="info-row">
                                <div class="info-item">
                                    <span class="label">RSI:</span>
                                    <span class="value" id="rsi2">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">MACD:</span>
                                    <span class="value" id="macd2">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">BB%:</span>
                                    <span class="value" id="bb2">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Volatility:</span>
                                    <span class="value" id="volatility2">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chart 3 & 4 (Hidden by default, shown in quad mode) -->
                    <div class="chart-section" id="chart3-section" style="display: none;">
                        <div class="chart-header">
                            <div class="chart-title-group">
                                <h2 id="chart3-title">BTC/USDT - 15 Minutes</h2>
                                <div class="timeframe-selector">
                                    <select id="timeframe3-select" class="timeframe-select">
                                        <option value="1m">1m</option>
                                        <option value="3m">3m</option>
                                        <option value="5m">5m</option>
                                        <option value="15m" selected>15m</option>
                                        <option value="30m">30m</option>
                                        <option value="1h">1h</option>
                                        <option value="2h">2h</option>
                                        <option value="4h">4h</option>
                                        <option value="6h">6h</option>
                                        <option value="8h">8h</option>
                                        <option value="12h">12h</option>
                                        <option value="1d">1d</option>
                                        <option value="3d">3d</option>
                                        <option value="1w">1w</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-controls">
                                <div class="indicator-toggles">
                                    <button class="indicator-btn" data-indicator="volume" data-chart="3">📊</button>
                                    <button class="indicator-btn" data-indicator="ma" data-chart="3">📈</button>
                                    <button class="indicator-btn" data-indicator="bollinger" data-chart="3">📊</button>
                                    <button class="indicator-btn" data-indicator="rsi" data-chart="3">📊</button>
                                    <button class="indicator-btn" data-indicator="macd" data-chart="3">📊</button>
                                </div>
                                <div class="chart-stats">
                                    <span class="price" id="price3">Loading...</span>
                                    <span class="change" id="change3">-</span>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container" id="chart3-container"></div>
                        <div class="chart-info">
                            <div class="info-row">
                                <div class="info-item">
                                    <span class="label">Open:</span>
                                    <span class="value" id="open3">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">High:</span>
                                    <span class="value" id="high3">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Low:</span>
                                    <span class="value" id="low3">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Volume:</span>
                                    <span class="value" id="volume3">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="chart-section" id="chart4-section" style="display: none;">
                        <div class="chart-header">
                            <div class="chart-title-group">
                                <h2 id="chart4-title">BTC/USDT - 1 Hour</h2>
                                <div class="timeframe-selector">
                                    <select id="timeframe4-select" class="timeframe-select">
                                        <option value="1m">1m</option>
                                        <option value="3m">3m</option>
                                        <option value="5m">5m</option>
                                        <option value="15m">15m</option>
                                        <option value="30m">30m</option>
                                        <option value="1h" selected>1h</option>
                                        <option value="2h">2h</option>
                                        <option value="4h">4h</option>
                                        <option value="6h">6h</option>
                                        <option value="8h">8h</option>
                                        <option value="12h">12h</option>
                                        <option value="1d">1d</option>
                                        <option value="3d">3d</option>
                                        <option value="1w">1w</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-controls">
                                <div class="indicator-toggles">
                                    <button class="indicator-btn" data-indicator="volume" data-chart="4">📊</button>
                                    <button class="indicator-btn" data-indicator="ma" data-chart="4">📈</button>
                                    <button class="indicator-btn" data-indicator="bollinger" data-chart="4">📊</button>
                                    <button class="indicator-btn" data-indicator="rsi" data-chart="4">📊</button>
                                    <button class="indicator-btn" data-indicator="macd" data-chart="4">📊</button>
                                </div>
                                <div class="chart-stats">
                                    <span class="price" id="price4">Loading...</span>
                                    <span class="change" id="change4">-</span>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container" id="chart4-container"></div>
                        <div class="chart-info">
                            <div class="info-row">
                                <div class="info-item">
                                    <span class="label">Open:</span>
                                    <span class="value" id="open4">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">High:</span>
                                    <span class="value" id="high4">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Low:</span>
                                    <span class="value" id="low4">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Volume:</span>
                                    <span class="value" id="volume4">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Side Panel for Chart Controls -->
            <div class="side-panel" id="side-panel">
                <div class="side-panel-header">
                    <h3>🎨 Chart Style</h3>
                    <button class="close-btn" id="close-side-panel">✕</button>
                </div>
                <div class="side-panel-content">
                    <!-- Chart Theme -->
                    <div class="control-group">
                        <label class="control-label">Theme</label>
                        <select id="chart-theme-select" class="control-select">
                            <option value="dark">Dark</option>
                            <option value="light">Light</option>
                        </select>
                    </div>

                    <!-- Chart Display Options -->
                    <div class="control-group">
                        <label class="control-label">Display Options</label>
                        <div class="control-checkboxes">
                            <label class="checkbox-label">
                                <input type="checkbox" id="crosshair-toggle" checked>
                                <span>Crosshair</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="grid-toggle" checked>
                                <span>Grid</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="price-scale-toggle" checked>
                                <span>Price Scale</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="time-scale-toggle" checked>
                                <span>Time Scale</span>
                            </label>
                        </div>
                    </div>

                    <!-- Real-time Data Options -->
                    <div class="control-group">
                        <label class="control-label">Real-time Data</label>
                        <div class="control-checkboxes">
                            <label class="checkbox-label">
                                <input type="checkbox" id="auto-scale-toggle" checked>
                                <span>Auto Scale</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="live-updates-toggle" checked>
                                <span>Live Updates</span>
                            </label>
                        </div>
                    </div>

                    <!-- Chart Actions -->
                    <div class="control-group">
                        <label class="control-label">Actions</label>
                        <button class="control-btn" id="reset-zoom-btn">🔍 Reset Zoom</button>
                        <button class="control-btn" id="screenshot-btn">📸 Screenshot</button>
                    </div>

                    <!-- Market Data -->
                    <div class="control-group">
                        <label class="control-label">Market Overview</label>
                        <div class="market-stats">
                            <div class="stat-item">
                                <span class="stat-label">24h Volume:</span>
                                <span class="stat-value" id="market-volume">Loading...</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Market Cap:</span>
                                <span class="stat-value" id="market-cap">Loading...</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Fear & Greed:</span>
                                <span class="stat-value" id="fear-greed">Loading...</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">BTC Dominance:</span>
                                <span class="stat-value" id="btc-dominance">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Connection Status -->
        <footer class="status-bar">
            <div class="status-item">
                <span class="status-label">Chart 1 WebSocket:</span>
                <span class="status-indicator" id="ws1-status">Connecting...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Chart 2 WebSocket:</span>
                <span class="status-indicator" id="ws2-status">Connecting...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Chart 3 WebSocket:</span>
                <span class="status-indicator" id="ws3-status">Disconnected</span>
            </div>
            <div class="status-item">
                <span class="status-label">Chart 4 WebSocket:</span>
                <span class="status-indicator" id="ws4-status">Disconnected</span>
            </div>
            <div class="status-item">
                <span class="status-label">Data Quality:</span>
                <span class="status-indicator" id="data-quality">Monitoring...</span>
            </div>
        </footer>

        <!-- Alert Modal -->
        <div class="modal" id="alert-modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>🔔 Price Alerts</h3>
                    <button class="modal-close" id="alert-modal-close">✕</button>
                </div>
                <div class="modal-body">
                    <div class="alert-form">
                        <div class="form-group">
                            <label>Alert Type:</label>
                            <select id="alert-type">
                                <option value="price">Price Alert</option>
                                <option value="volume">Volume Alert</option>
                                <option value="rsi">RSI Alert</option>
                                <option value="macd">MACD Signal</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Condition:</label>
                            <select id="alert-condition">
                                <option value="above">Above</option>
                                <option value="below">Below</option>
                                <option value="crosses">Crosses</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Value:</label>
                            <input type="number" id="alert-value" placeholder="Enter value">
                        </div>
                        <button class="btn btn-primary" id="add-alert">Add Alert</button>
                    </div>
                    <div class="active-alerts">
                        <h4>Active Alerts</h4>
                        <div id="alerts-list">
                            <!-- Dynamic alerts will be added here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis Modal -->
        <div class="modal" id="analysis-modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>📊 Technical Analysis</h3>
                    <button class="modal-close" id="analysis-modal-close">✕</button>
                </div>
                <div class="modal-body">
                    <div class="analysis-tabs">
                        <button class="tab-btn active" data-tab="indicators">Indicators</button>
                        <button class="tab-btn" data-tab="patterns">Patterns</button>
                        <button class="tab-btn" data-tab="signals">Signals</button>
                    </div>
                    <div class="tab-content" id="analysis-content">
                        <!-- Dynamic analysis content will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="charts-dashboard.ts"></script>
</body>
</html> 