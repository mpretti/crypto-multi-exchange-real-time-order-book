<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📊 Advanced Volume Analytics - Crypto Exchange Monitor</title>
    <link rel="stylesheet" href="volume-dashboard.css">
    <link rel="stylesheet" href="index.css">
    <!-- Enhanced Chart Libraries -->
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Enhanced Header with Navigation -->
        <header class="header-section">
            <h1>📊 Advanced Volume Analytics Dashboard</h1>
            <nav class="nav-links">
                <a href="index.html">📈 Order Book</a>
                <a href="charts-dashboard.html">📊 Charts</a>
                <a href="volume-dashboard.html" class="active">📊 Volume</a>
                <a href="trading-pairs-explorer.html">🔍 Trading Pairs</a>
                <a href="exchange-status.html">🔧 Exchange Status</a>
                <a href="http://localhost:3001/" target="_blank">📊 Historical Data</a>
            </nav>
        </header>

        <!-- Enhanced Control Panel -->
        <div class="enhanced-controls-panel">
            <div class="control-section">
                <h3>🎯 Analysis Mode</h3>
                <div class="mode-buttons">
                    <button class="mode-btn active" data-mode="realtime">⚡ Real-time</button>
                    <button class="mode-btn" data-mode="heatmap">🔥 Heatmap</button>
                    <button class="mode-btn" data-mode="flow">🌊 Flow Analysis</button>
                    <button class="mode-btn" data-mode="comparison">📊 Cross-Exchange</button>
                </div>
            </div>
            
            <div class="control-section">
                <h3>⏱️ Time Range</h3>
                <select id="timeRange" class="enhanced-select">
                    <option value="1m">Last 1 Minute</option>
                    <option value="5m" selected>Last 5 Minutes</option>
                    <option value="15m">Last 15 Minutes</option>
                    <option value="1h">Last 1 Hour</option>
                    <option value="4h">Last 4 Hours</option>
                    <option value="24h">Last 24 Hours</option>
                </select>
            </div>
            
            <div class="control-section">
                <h3>🎨 Visualization</h3>
                <div class="checkbox-group">
                    <label><input type="checkbox" id="showVolumeBars" checked> 📊 Volume Bars</label>
                    <label><input type="checkbox" id="showTrendLines" checked> 📈 Trend Lines</label>
                    <label><input type="checkbox" id="showMovingAvg" checked> 📉 Moving Average</label>
                    <label><input type="checkbox" id="showAlerts"> 🔔 Volume Alerts</label>
                </div>
            </div>
        </div>

        <!-- Volume Analytics Grid -->
        <div class="analytics-grid">
            <!-- Real-time Volume Monitor -->
            <div class="analytics-card">
                <div class="card-header">
                    <h3>⚡ Real-time Volume Monitor</h3>
                    <div class="card-controls">
                        <button class="control-btn" onclick="VolumeAnalytics.pauseUpdates()">⏸️</button>
                        <button class="control-btn" onclick="VolumeAnalytics.resetData()">🔄</button>
                        <button class="control-btn" onclick="VolumeAnalytics.exportData()">💾</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="realtimeVolumeChart"></canvas>
                </div>
                <div class="chart-stats">
                    <div class="stat-item">
                        <span class="stat-label">Current Volume:</span>
                        <span class="stat-value" id="currentVolume">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Peak Volume:</span>
                        <span class="stat-value" id="peakVolume">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Avg Volume:</span>
                        <span class="stat-value" id="avgVolume">-</span>
                    </div>
                </div>
            </div>

            <!-- Volume Heatmap -->
            <div class="analytics-card">
                <div class="card-header">
                    <h3>🔥 Volume Heatmap</h3>
                    <div class="heatmap-controls">
                        <select id="heatmapMetric">
                            <option value="volume">Volume</option>
                            <option value="trades">Trade Count</option>
                            <option value="volatility">Volatility</option>
                        </select>
                    </div>
                </div>
                <div class="heatmap-container" id="volumeHeatmap">
                    <!-- Heatmap will be generated here -->
                </div>
                <div class="heatmap-legend">
                    <span class="legend-low">Low</span>
                    <div class="legend-gradient"></div>
                    <span class="legend-high">High</span>
                </div>
            </div>

            <!-- Exchange Comparison -->
            <div class="analytics-card full-width">
                <div class="card-header">
                    <h3>📊 Cross-Exchange Volume Comparison</h3>
                    <div class="comparison-controls">
                        <button class="toggle-btn" data-exchange="binance">Binance</button>
                        <button class="toggle-btn" data-exchange="bybit">Bybit</button>
                        <button class="toggle-btn" data-exchange="okx">OKX</button>
                        <button class="toggle-btn" data-exchange="kraken">Kraken</button>
                        <button class="toggle-btn" data-exchange="uniswap">Uniswap</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </div>

            <!-- Volume Flow Analysis -->
            <div class="analytics-card">
                <div class="card-header">
                    <h3>🌊 Volume Flow Analysis</h3>
                    <div class="flow-indicators">
                        <div class="flow-indicator" id="buyPressure">
                            <span class="indicator-label">Buy Pressure</span>
                            <div class="indicator-bar">
                                <div class="indicator-fill buy-fill"></div>
                            </div>
                            <span class="indicator-value">65%</span>
                        </div>
                        <div class="flow-indicator" id="sellPressure">
                            <span class="indicator-label">Sell Pressure</span>
                            <div class="indicator-bar">
                                <div class="indicator-fill sell-fill"></div>
                            </div>
                            <span class="indicator-value">35%</span>
                        </div>
                    </div>
                </div>
                <div class="flow-chart-container">
                    <canvas id="flowChart"></canvas>
                </div>
            </div>

            <!-- Volume Alerts -->
            <div class="analytics-card">
                <div class="card-header">
                    <h3>🔔 Volume Alerts & Anomalies</h3>
                    <button class="add-alert-btn" onclick="VolumeAnalytics.addAlert()">+ Add Alert</button>
                </div>
                <div class="alerts-container" id="alertsContainer">
                    <div class="alert-item active">
                        <div class="alert-icon">🚨</div>
                        <div class="alert-content">
                            <div class="alert-title">High Volume Spike</div>
                            <div class="alert-description">Binance volume increased 340% in last 5 minutes</div>
                            <div class="alert-time">2 minutes ago</div>
                        </div>
                    </div>
                    <div class="alert-item">
                        <div class="alert-icon">⚠️</div>
                        <div class="alert-content">
                            <div class="alert-title">Unusual Pattern</div>
                            <div class="alert-description">Coordinated volume increase across multiple exchanges</div>
                            <div class="alert-time">8 minutes ago</div>
                        </div>
                    </div>
                    <div class="alert-item">
                        <div class="alert-icon">📈</div>
                        <div class="alert-content">
                            <div class="alert-title">Volume Threshold</div>
                            <div class="alert-description">Daily volume exceeded 1M BTC threshold</div>
                            <div class="alert-time">15 minutes ago</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Whale Watcher -->
            <div class="analytics-card full-width">
                <div class="card-header">
                    <h3>🐋 Whale Watcher - Large Trades Monitor</h3>
                    <div class="whale-controls">
                        <select id="whaleThreshold">
                            <option value="100">100+ BTC</option>
                            <option value="250" selected>250+ BTC</option>
                            <option value="500">500+ BTC</option>
                            <option value="1000">1000+ BTC</option>
                        </select>
                        <button class="control-btn" onclick="WhaleWatcher.exportWhales()">💾 Export</button>
                        <button class="control-btn" onclick="window.open('http://localhost:3001/', '_blank')">📊 Historical</button>
                        <button class="control-btn" onclick="WhaleWatcher.clearWhales()">🗑️ Clear</button>
                    </div>
                </div>
                <div class="whale-content">
                    <div class="whale-stats">
                        <div class="whale-stat">
                            <div class="stat-icon">🐋</div>
                            <div class="stat-info">
                                <div class="stat-value" id="whaleCount">0</div>
                                <div class="stat-label">Whale Trades (24h)</div>
                            </div>
                        </div>
                        <div class="whale-stat">
                            <div class="stat-icon">💰</div>
                            <div class="stat-info">
                                <div class="stat-value" id="whaleVolume">0 BTC</div>
                                <div class="stat-label">Whale Volume</div>
                            </div>
                        </div>
                        <div class="whale-stat">
                            <div class="stat-icon">📊</div>
                            <div class="stat-info">
                                <div class="stat-value" id="whalePercent">0%</div>
                                <div class="stat-label">% of Total Volume</div>
                            </div>
                        </div>
                        <div class="whale-stat">
                            <div class="stat-icon">🎯</div>
                            <div class="stat-info">
                                <div class="stat-value" id="largestWhale">0 BTC</div>
                                <div class="stat-label">Largest Trade</div>
                            </div>
                        </div>
                    </div>
                    <div class="whale-trades-container" id="whaleTradesContainer">
                        <div class="whale-trade-header">
                            <span>Time</span>
                            <span>Exchange</span>
                            <span>Type</span>
                            <span>Size (BTC)</span>
                            <span>Price</span>
                            <span>Value (USD)</span>
                        </div>
                        <div class="whale-trades-list" id="whaleTradesList">
                            <!-- Whale trades will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Time & Sales -->
            <div class="analytics-card full-width">
                <div class="card-header">
                    <h3>⏰ Time & Sales - Live Trade Feed</h3>
                    <div class="time-sales-controls">
                        <select id="exchangeFilter">
                            <option value="all">All Exchanges</option>
                            <option value="binance">Binance</option>
                            <option value="bybit">Bybit</option>
                            <option value="okx">OKX</option>
                            <option value="kraken">Kraken</option>
                            <option value="uniswap">Uniswap</option>
                        </select>
                        <select id="sizeFilter">
                            <option value="all">All Sizes</option>
                            <option value="1">1+ BTC</option>
                            <option value="10">10+ BTC</option>
                            <option value="50">50+ BTC</option>
                        </select>
                        <button class="control-btn" onclick="TimeSales.pauseUpdates()" id="pauseBtn">⏸️</button>
                        <button class="control-btn" onclick="TimeSales.exportTrades()">💾</button>
                        <button class="control-btn" onclick="window.open('http://localhost:3001/', '_blank')">📊 Historical</button>
                    </div>
                </div>
                <div class="time-sales-content">
                    <div class="time-sales-stats">
                        <div class="sales-stat">
                            <div class="stat-value" id="tradesPerSecond">0</div>
                            <div class="stat-label">Trades/sec</div>
                        </div>
                        <div class="sales-stat">
                            <div class="stat-value" id="avgTradeSize">0 BTC</div>
                            <div class="stat-label">Avg Size</div>
                        </div>
                        <div class="sales-stat">
                            <div class="stat-value" id="buyVsSell">50/50</div>
                            <div class="stat-label">Buy/Sell %</div>
                        </div>
                        <div class="sales-stat">
                            <div class="stat-value" id="totalTrades">0</div>
                            <div class="stat-label">Total Trades</div>
                        </div>
                    </div>
                    <div class="time-sales-container" id="timeSalesContainer">
                        <div class="time-sales-header">
                            <span>Time</span>
                            <span>Exchange</span>
                            <span>Side</span>
                            <span>Size</span>
                            <span>Price</span>
                            <span>Value</span>
                        </div>
                        <div class="time-sales-list" id="timeSalesList">
                            <!-- Live trades will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Metrics -->
            <div class="analytics-card">
                <div class="card-header">
                    <h3>📈 Advanced Volume Metrics</h3>
                </div>
                <div class="metrics-grid">
                    <div class="metric-item">
                        <div class="metric-label">VWAP</div>
                        <div class="metric-value">$44,721.45</div>
                        <div class="metric-change positive">+0.12%</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Volume RSI</div>
                        <div class="metric-value">67.8</div>
                        <div class="metric-change negative">-2.1</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">OBV</div>
                        <div class="metric-value">2.34M</div>
                        <div class="metric-change positive">+5.7%</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Volume Profile</div>
                        <div class="metric-value">Bullish</div>
                        <div class="metric-change positive">Strong</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Footer -->
        <footer class="enhanced-footer">
            <div class="footer-stats">
                <div class="stat-group">
                    <span class="stat-label">Total Volume (24h):</span>
                    <span class="stat-value">1.2M BTC</span>
                </div>
                <div class="stat-group">
                    <span class="stat-label">Active Exchanges:</span>
                    <span class="stat-value">8</span>
                </div>
                <div class="stat-group">
                    <span class="stat-label">Last Update:</span>
                    <span class="stat-value" id="lastUpdate">Just now</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- Enhanced Volume Analytics Engine -->
    <script>
    class VolumeAnalytics {
        constructor() {
            this.charts = {};
            this.data = {
                realtime: [],
                heatmap: [],
                comparison: {},
                flow: { buy: [], sell: [] }
            };
            this.isRunning = true;
            this.alerts = [];
            this.init();
        }

        init() {
            console.log('🚀 Initializing Enhanced Volume Analytics...');
            this.initCharts();
            this.initHeatmap();
            this.bindEvents();
            this.startDataUpdates();
            this.showWelcomeMessage();
        }

        initCharts() {
            // Real-time Volume Chart
            const realtimeCtx = document.getElementById('realtimeVolumeChart').getContext('2d');
            this.charts.realtime = new Chart(realtimeCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Volume',
                        data: [],
                        borderColor: '#4facfe',
                        backgroundColor: 'rgba(79, 172, 254, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: { display: false },
                        y: { 
                            beginAtZero: true,
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: '#e0e0e0' }
                        }
                    },
                    animation: { duration: 750 }
                }
            });

            // Comparison Chart
            const comparisonCtx = document.getElementById('comparisonChart').getContext('2d');
            this.charts.comparison = new Chart(comparisonCtx, {
                type: 'bar',
                data: {
                    labels: ['Binance', 'Bybit', 'OKX', 'Kraken', 'Uniswap'],
                    datasets: [{
                        label: 'Volume (BTC)',
                        data: [450, 320, 280, 150, 95],
                        backgroundColor: [
                            '#f3ba2f', '#f7931a', '#007bff', '#5c6bc0', '#ff6b9d'
                        ],
                        borderColor: [
                            '#f3ba2f', '#f7931a', '#007bff', '#5c6bc0', '#ff6b9d'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: '#e0e0e0' }
                        },
                        x: {
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: '#e0e0e0' }
                        }
                    }
                }
            });

            // Flow Chart
            const flowCtx = document.getElementById('flowChart').getContext('2d');
            this.charts.flow = new Chart(flowCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Buy Volume', 'Sell Volume'],
                    datasets: [{
                        data: [65, 35],
                        backgroundColor: ['#26de81', '#ff4757'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: { color: '#e0e0e0' }
                        }
                    }
                }
            });
        }

        initHeatmap() {
            const container = document.getElementById('volumeHeatmap');
            const exchanges = ['Binance', 'Bybit', 'OKX', 'Kraken', 'Uniswap'];
            const timeSlots = ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'];
            
            container.innerHTML = '';
            
            const heatmapGrid = document.createElement('div');
            heatmapGrid.className = 'heatmap-grid';
            heatmapGrid.style.cssText = `
                display: grid;
                grid-template-columns: repeat(${timeSlots.length}, 1fr);
                grid-template-rows: repeat(${exchanges.length}, 1fr);
                gap: 2px;
                height: 100%;
            `;
            
            exchanges.forEach((exchange, i) => {
                timeSlots.forEach((time, j) => {
                    const cell = document.createElement('div');
                    const intensity = Math.random();
                    cell.className = 'heatmap-cell';
                    cell.style.cssText = `
                        background: rgba(79, 172, 254, ${intensity});
                        border-radius: 4px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-size: 10px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.2s ease;
                    `;
                    cell.textContent = `${(intensity * 100).toFixed(0)}%`;
                    cell.title = `${exchange} at ${time}: ${(intensity * 1000).toFixed(0)} BTC`;
                    
                    cell.addEventListener('mouseenter', () => {
                        cell.style.transform = 'scale(1.1)';
                        cell.style.zIndex = '10';
                    });
                    
                    cell.addEventListener('mouseleave', () => {
                        cell.style.transform = 'scale(1)';
                        cell.style.zIndex = '1';
                    });
                    
                    heatmapGrid.appendChild(cell);
                });
            });
            
            container.appendChild(heatmapGrid);
        }

        bindEvents() {
            // Mode buttons
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    this.switchMode(e.target.dataset.mode);
                });
            });

            // Time range selector
            document.getElementById('timeRange').addEventListener('change', (e) => {
                this.updateTimeRange(e.target.value);
            });

            // Checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    this.toggleFeature(e.target.id, e.target.checked);
                });
            });
        }

        startDataUpdates() {
            // Update real-time data every 2 seconds
            setInterval(() => {
                if (this.isRunning) {
                    this.updateRealtimeData();
                    this.updateMetrics();
                    this.checkAlerts();
                }
            }, 2000);

            // Update heatmap every 30 seconds
            setInterval(() => {
                if (this.isRunning) {
                    this.updateHeatmap();
                }
            }, 30000);
        }

        updateRealtimeData() {
            const now = new Date();
            const volume = Math.random() * 100 + 50;
            
            // Add new data point
            this.data.realtime.push({ time: now, volume });
            
            // Keep only last 50 points
            if (this.data.realtime.length > 50) {
                this.data.realtime.shift();
            }
            
            // Update chart
            const chart = this.charts.realtime;
            chart.data.labels = this.data.realtime.map(d => d.time.toLocaleTimeString());
            chart.data.datasets[0].data = this.data.realtime.map(d => d.volume);
            chart.update('none');
            
            // Update stats
            const current = volume.toFixed(2);
            const peak = Math.max(...this.data.realtime.map(d => d.volume)).toFixed(2);
            const avg = (this.data.realtime.reduce((a, b) => a + b.volume, 0) / this.data.realtime.length).toFixed(2);
            
            document.getElementById('currentVolume').textContent = `${current} BTC`;
            document.getElementById('peakVolume').textContent = `${peak} BTC`;
            document.getElementById('avgVolume').textContent = `${avg} BTC`;
        }

        updateMetrics() {
            // Update flow indicators
            const buyPressure = 50 + Math.random() * 40;
            const sellPressure = 100 - buyPressure;
            
            document.querySelector('#buyPressure .indicator-fill').style.width = `${buyPressure}%`;
            document.querySelector('#buyPressure .indicator-value').textContent = `${buyPressure.toFixed(0)}%`;
            
            document.querySelector('#sellPressure .indicator-fill').style.width = `${sellPressure}%`;
            document.querySelector('#sellPressure .indicator-value').textContent = `${sellPressure.toFixed(0)}%`;
            
            // Update flow chart
            this.charts.flow.data.datasets[0].data = [buyPressure, sellPressure];
            this.charts.flow.update('none');
            
            // Update comparison chart with random variations
            this.charts.comparison.data.datasets[0].data = this.charts.comparison.data.datasets[0].data.map(val => 
                val + (Math.random() - 0.5) * 20
            );
            this.charts.comparison.update('none');
        }

        updateHeatmap() {
            const cells = document.querySelectorAll('.heatmap-cell');
            cells.forEach(cell => {
                const intensity = Math.random();
                cell.style.background = `rgba(79, 172, 254, ${intensity})`;
                cell.textContent = `${(intensity * 100).toFixed(0)}%`;
            });
        }

        checkAlerts() {
            // Simulate alert checking
            if (Math.random() < 0.01) { // 1% chance
                this.addAlert({
                    type: 'spike',
                    title: 'Volume Spike Detected',
                    description: `${this.getRandomExchange()} volume increased ${(Math.random() * 200 + 100).toFixed(0)}%`,
                    time: new Date()
                });
            }
        }

        switchMode(mode) {
            console.log(`📊 Switching to ${mode} mode`);
            this.showNotification(`📊 ${mode.charAt(0).toUpperCase() + mode.slice(1)} mode activated`);
            
            // Hide/show relevant sections based on mode
            // Implementation would depend on specific mode requirements
        }

        updateTimeRange(range) {
            console.log(`⏱️ Time range changed to ${range}`);
            this.showNotification(`⏱️ Time range: ${range}`);
        }

        toggleFeature(feature, enabled) {
            console.log(`🔧 ${feature}: ${enabled ? 'enabled' : 'disabled'}`);
            this.showNotification(`${enabled ? '✅' : '❌'} ${feature} ${enabled ? 'enabled' : 'disabled'}`);
        }

        pauseUpdates() {
            this.isRunning = !this.isRunning;
            const btn = event.target;
            btn.textContent = this.isRunning ? '⏸️' : '▶️';
            this.showNotification(this.isRunning ? '▶️ Updates resumed' : '⏸️ Updates paused');
        }

        resetData() {
            this.data.realtime = [];
            this.charts.realtime.data.labels = [];
            this.charts.realtime.data.datasets[0].data = [];
            this.charts.realtime.update();
            this.showNotification('🔄 Data reset');
        }

        exportData() {
            const data = {
                timestamp: new Date().toISOString(),
                realtime: this.data.realtime,
                alerts: this.alerts
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `volume-data-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            this.showNotification('💾 Data exported');
        }

        addAlert(alert = null) {
            if (!alert) {
                alert = {
                    type: 'custom',
                    title: 'Custom Alert',
                    description: 'User-defined alert condition met',
                    time: new Date()
                };
            }
            
            this.alerts.unshift(alert);
            
            const container = document.getElementById('alertsContainer');
            const alertEl = document.createElement('div');
            alertEl.className = 'alert-item active';
            alertEl.innerHTML = `
                <div class="alert-icon">🔔</div>
                <div class="alert-content">
                    <div class="alert-title">${alert.title}</div>
                    <div class="alert-description">${alert.description}</div>
                    <div class="alert-time">Just now</div>
                </div>
            `;
            
            container.insertBefore(alertEl, container.firstChild);
            
            // Remove old alerts if too many
            if (container.children.length > 10) {
                container.removeChild(container.lastChild);
            }
            
            this.showNotification(`🔔 ${alert.title}`);
        }

        getRandomExchange() {
            const exchanges = ['Binance', 'Bybit', 'OKX', 'Kraken', 'Uniswap'];
            return exchanges[Math.floor(Math.random() * exchanges.length)];
        }

        showWelcomeMessage() {
            setTimeout(() => {
                this.showNotification('🎉 Enhanced Volume Analytics ready! Real-time monitoring active.');
            }, 1000);
        }

        showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(79, 172, 254, 0.9);
                color: white;
                padding: 12px 16px;
                border-radius: 8px;
                font-size: 14px;
                z-index: 10000;
                backdrop-filter: blur(10px);
                box-shadow: 0 4px 12px rgba(79, 172, 254, 0.3);
                animation: slideInRight 0.3s ease;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease forwards';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    }

    // Global reference for easy access
    window.VolumeAnalytics = VolumeAnalytics;

    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
        window.volumeAnalytics = new VolumeAnalytics();
    });

    // 🐋 Whale Watcher Implementation
    class WhaleWatcher {
        constructor() {
            this.whales = [];
            this.threshold = 250; // Default 250 BTC
            this.totalWhaleVolume = 0;
            this.isActive = true;
            this.init();
        }

        init() {
            console.log('🐋 Initializing Whale Watcher...');
            this.bindEvents();
            this.startWhaleDetection();
            this.updateWhaleStats();
            this.showNotification('🐋 Whale Watcher activated - monitoring large trades');
        }

        bindEvents() {
            const thresholdSelect = document.getElementById('whaleThreshold');
            if (thresholdSelect) {
                thresholdSelect.addEventListener('change', (e) => {
                    this.threshold = parseInt(e.target.value);
                    this.filterWhalesByThreshold();
                    this.showNotification(`🐋 Whale threshold set to ${this.threshold}+ BTC`);
                });
            }
        }

        startWhaleDetection() {
            const detectWhale = () => {
                if (this.isActive && Math.random() < 0.25) { // 25% chance of whale trade
                    this.generateWhaleTradeData();
                }
                setTimeout(detectWhale, Math.random() * 8000 + 2000); // 2-10 seconds
            };
            detectWhale();
        }

        generateWhaleTradeData() {
            const exchanges = [
                { name: 'Binance', color: '#f3ba2f' },
                { name: 'Bybit', color: '#f7931a' },
                { name: 'OKX', color: '#007bff' },
                { name: 'Kraken', color: '#5c6bc0' },
                { name: 'Uniswap', color: '#ff6b9d' }
            ];
            const sides = ['BUY', 'SELL'];
            
            // Generate whale-sized trade
            const minSize = this.threshold;
            const maxSize = this.threshold * 8; // Up to 8x threshold
            const size = minSize + Math.random() * (maxSize - minSize);
            const basePrice = 44700;
            const price = basePrice + (Math.random() - 0.5) * 300; // ±$150 variance
            const value = size * price;
            const exchange = exchanges[Math.floor(Math.random() * exchanges.length)];
            
            const whale = {
                id: Date.now() + Math.random(),
                time: new Date(),
                exchange: exchange.name,
                exchangeColor: exchange.color,
                side: sides[Math.floor(Math.random() * sides.length)],
                size: size,
                price: price,
                value: value,
                isNew: true,
                timestamp: Date.now()
            };

            this.whales.unshift(whale);
            this.totalWhaleVolume += size;

            // Keep only last 200 whale trades
            if (this.whales.length > 200) {
                const removed = this.whales.splice(200);
                removed.forEach(w => this.totalWhaleVolume -= w.size);
            }

            this.updateWhaleDisplay();
            this.updateWhaleStats();
            
            // Show notifications for significant whales
            if (size > 2000) {
                this.showNotification(`🚨 MEGA WHALE: ${size.toFixed(0)} BTC (${(value/1000000).toFixed(1)}M USD) on ${whale.exchange}!`);
            } else if (size > 1000) {
                this.showNotification(`🐋 LARGE WHALE: ${size.toFixed(0)} BTC on ${whale.exchange}`);
            }
        }

        updateWhaleDisplay() {
            const container = document.getElementById('whaleTradesList');
            if (!container) return;

            container.innerHTML = '';

            const filteredWhales = this.whales.filter(w => w.size >= this.threshold);
            
            filteredWhales.slice(0, 50).forEach((whale, index) => {
                const tradeEl = document.createElement('div');
                tradeEl.className = `whale-trade ${whale.isNew ? 'new' : ''}`;
                
                // Add whale size indicator
                let whaleIcon = '🐋';
                if (whale.size > 2000) whaleIcon = '🐳'; // Mega whale
                else if (whale.size > 1000) whaleIcon = '🐋'; // Large whale
                else if (whale.size > 500) whaleIcon = '🐟'; // Medium whale
                
                tradeEl.innerHTML = `
                    <span class="trade-time">${whale.time.toLocaleTimeString()}</span>
                    <span class="trade-exchange" style="color: ${whale.exchangeColor}">${whale.exchange}</span>
                    <span class="trade-side ${whale.side.toLowerCase()}">${whaleIcon} ${whale.side}</span>
                    <span class="trade-size">${whale.size.toFixed(1)} BTC</span>
                    <span class="trade-price">$${whale.price.toFixed(2)}</span>
                    <span class="trade-value">$${(whale.value / 1000000).toFixed(2)}M</span>
                `;
                
                container.appendChild(tradeEl);
                
                // Remove new class after animation
                if (whale.isNew) {
                    setTimeout(() => {
                        whale.isNew = false;
                        tradeEl.classList.remove('new');
                    }, 3000);
                }
            });
        }

        updateWhaleStats() {
            const now = Date.now();
            const last24h = now - (24 * 60 * 60 * 1000);
            const filteredWhales = this.whales.filter(w => w.size >= this.threshold && w.timestamp > last24h);
            
            const whaleCount = filteredWhales.length;
            const whaleVolume = filteredWhales.reduce((sum, w) => sum + w.size, 0);
            const largestWhale = filteredWhales.length > 0 ? Math.max(...filteredWhales.map(w => w.size)) : 0;
            const totalVolume = 75000; // Simulated total market volume (24h)
            const whalePercent = totalVolume > 0 ? (whaleVolume / totalVolume) * 100 : 0;

            this.updateElement('whaleCount', whaleCount.toString());
            this.updateElement('whaleVolume', `${whaleVolume.toFixed(0)} BTC`);
            this.updateElement('whalePercent', `${whalePercent.toFixed(1)}%`);
            this.updateElement('largestWhale', `${largestWhale.toFixed(0)} BTC`);
        }

        filterWhalesByThreshold() {
            this.updateWhaleDisplay();
            this.updateWhaleStats();
        }

        exportWhales() {
            const filteredWhales = this.whales.filter(w => w.size >= this.threshold);
            const data = {
                timestamp: new Date().toISOString(),
                threshold: this.threshold,
                whales: filteredWhales,
                summary: {
                    totalWhales: filteredWhales.length,
                    totalVolume: filteredWhales.reduce((sum, w) => sum + w.size, 0),
                    avgTradeSize: filteredWhales.length > 0 ? filteredWhales.reduce((sum, w) => sum + w.size, 0) / filteredWhales.length : 0,
                    largestTrade: filteredWhales.length > 0 ? Math.max(...filteredWhales.map(w => w.size)) : 0
                }
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `whale-trades-${this.threshold}btc-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            this.showNotification(`💾 Exported ${filteredWhales.length} whale trades`);
        }

        clearWhales() {
            this.whales = [];
            this.totalWhaleVolume = 0;
            this.updateWhaleDisplay();
            this.updateWhaleStats();
            this.showNotification('🗑️ All whale trades cleared');
        }

        updateElement(id, value) {
            const el = document.getElementById(id);
            if (el) el.textContent = value;
        }

        showNotification(message) {
            console.log(message);
            // Use the existing notification system from VolumeAnalytics
            if (window.volumeAnalytics) {
                window.volumeAnalytics.showNotification(message);
            }
        }
    }

    // ⏰ Time & Sales Implementation
    class TimeSales {
        constructor() {
            this.trades = [];
            this.isRunning = true;
            this.exchangeFilter = 'all';
            this.sizeFilter = 'all';
            this.tradesPerSecond = 0;
            this.tradeCount = 0;
            this.buyCount = 0;
            this.sellCount = 0;
            this.totalVolume = 0;
            this.init();
        }

        init() {
            console.log('⏰ Initializing Time & Sales...');
            this.bindEvents();
            this.startTradeGeneration();
            this.startStatsUpdater();
            this.showNotification('⏰ Time & Sales activated - monitoring all trades');
        }

        bindEvents() {
            const exchangeFilter = document.getElementById('exchangeFilter');
            if (exchangeFilter) {
                exchangeFilter.addEventListener('change', (e) => {
                    this.exchangeFilter = e.target.value;
                    this.updateTradeDisplay();
                    this.showNotification(`📊 Filter: ${e.target.value === 'all' ? 'All Exchanges' : e.target.value}`);
                });
            }

            const sizeFilter = document.getElementById('sizeFilter');
            if (sizeFilter) {
                sizeFilter.addEventListener('change', (e) => {
                    this.sizeFilter = e.target.value === 'all' ? 'all' : parseFloat(e.target.value);
                    this.updateTradeDisplay();
                    this.showNotification(`📏 Size filter: ${e.target.value === 'all' ? 'All Sizes' : e.target.value + '+ BTC'}`);
                });
            }
        }

        startTradeGeneration() {
            const generateTrade = () => {
                if (this.isRunning) {
                    // Generate 1-8 trades at once (burst trading)
                    const numTrades = Math.floor(Math.random() * 8) + 1;
                    for (let i = 0; i < numTrades; i++) {
                        setTimeout(() => this.generateTradeData(), i * 50); // Stagger by 50ms
                    }
                }
                setTimeout(generateTrade, Math.random() * 3000 + 500); // 0.5-3.5 seconds
            };
            generateTrade();
        }

        generateTradeData() {
            const exchanges = [
                { name: 'Binance', color: '#f3ba2f', volume: 0.4 },
                { name: 'Bybit', color: '#f7931a', volume: 0.25 },
                { name: 'OKX', color: '#007bff', volume: 0.15 },
                { name: 'Kraken', color: '#5c6bc0', volume: 0.1 },
                { name: 'Uniswap', color: '#ff6b9d', volume: 0.1 }
            ];
            
            // Weighted exchange selection based on volume
            const rand = Math.random();
            let cumulative = 0;
            let selectedExchange = exchanges[0];
            
            for (const exchange of exchanges) {
                cumulative += exchange.volume;
                if (rand <= cumulative) {
                    selectedExchange = exchange;
                    break;
                }
            }
            
            const sides = ['BUY', 'SELL'];
            
            // Generate realistic trade sizes (most trades are small)
            let size;
            const sizeRand = Math.random();
            if (sizeRand < 0.7) {
                size = Math.random() * 5 + 0.01; // 70% small trades (0.01-5 BTC)
            } else if (sizeRand < 0.9) {
                size = Math.random() * 20 + 5; // 20% medium trades (5-25 BTC)
            } else {
                size = Math.random() * 100 + 25; // 10% large trades (25-125 BTC)
            }
            
            const basePrice = 44700;
            const price = basePrice + (Math.random() - 0.5) * 50; // ±$25 variance
            const value = size * price;
            const side = sides[Math.floor(Math.random() * sides.length)];
            
            const trade = {
                id: Date.now() + Math.random(),
                time: new Date(),
                exchange: selectedExchange.name,
                exchangeColor: selectedExchange.color,
                side: side,
                size: size,
                price: price,
                value: value,
                isNew: true,
                timestamp: Date.now()
            };

            this.trades.unshift(trade);
            this.tradeCount++;
            this.totalVolume += size;
            
            if (side === 'BUY') {
                this.buyCount++;
            } else {
                this.sellCount++;
            }

            // Keep only last 1000 trades
            if (this.trades.length > 1000) {
                const removed = this.trades.splice(1000);
                removed.forEach(t => this.totalVolume -= t.size);
            }

            this.updateTradeDisplay();
        }

        updateTradeDisplay() {
            const container = document.getElementById('timeSalesList');
            if (!container) return;

            // Filter trades
            let filteredTrades = this.trades;
            
            if (this.exchangeFilter !== 'all') {
                filteredTrades = filteredTrades.filter(t => t.exchange.toLowerCase() === this.exchangeFilter);
            }
            
            if (this.sizeFilter !== 'all' && this.sizeFilter > 0) {
                filteredTrades = filteredTrades.filter(t => t.size >= this.sizeFilter);
            }

            container.innerHTML = '';

            // Display filtered trades (last 100)
            filteredTrades.slice(0, 100).forEach(trade => {
                const tradeEl = document.createElement('div');
                tradeEl.className = `time-sales-trade ${trade.isNew ? 'new' : ''}`;
                
                // Add size indicator
                let sizeIcon = '';
                if (trade.size >= 100) sizeIcon = '🔥';
                else if (trade.size >= 50) sizeIcon = '⚡';
                else if (trade.size >= 10) sizeIcon = '📊';
                
                tradeEl.innerHTML = `
                    <span class="trade-time">${trade.time.toLocaleTimeString()}</span>
                    <span class="trade-exchange" style="color: ${trade.exchangeColor}">${trade.exchange}</span>
                    <span class="trade-side ${trade.side.toLowerCase()}">${sizeIcon} ${trade.side}</span>
                    <span class="trade-size">${trade.size.toFixed(3)} BTC</span>
                    <span class="trade-price">$${trade.price.toFixed(2)}</span>
                    <span class="trade-value">$${(trade.value / 1000).toFixed(1)}K</span>
                `;
                
                container.appendChild(tradeEl);
                
                // Remove new class after animation
                if (trade.isNew) {
                    setTimeout(() => {
                        trade.isNew = false;
                        tradeEl.classList.remove('new');
                    }, 2000);
                }
            });
        }

        startStatsUpdater() {
            let lastTradeCount = 0;
            let lastUpdateTime = Date.now();
            
            setInterval(() => {
                const now = Date.now();
                const timeDiff = (now - lastUpdateTime) / 1000; // seconds
                
                // Calculate trades per second
                const currentTradeCount = this.tradeCount;
                this.tradesPerSecond = Math.round((currentTradeCount - lastTradeCount) / timeDiff);
                lastTradeCount = currentTradeCount;
                lastUpdateTime = now;
                
                this.updateStats();
            }, 1000);
        }

        updateStats() {
            const recentTrades = this.trades.slice(0, 200); // Last 200 trades
            const avgSize = recentTrades.length > 0 ? 
                recentTrades.reduce((sum, t) => sum + t.size, 0) / recentTrades.length : 0;
            
            const buyTrades = recentTrades.filter(t => t.side === 'BUY').length;
            const sellTrades = recentTrades.filter(t => t.side === 'SELL').length;
            const total = buyTrades + sellTrades;
            const buyPercent = total > 0 ? (buyTrades / total * 100).toFixed(0) : 50;
            const sellPercent = total > 0 ? (sellTrades / total * 100).toFixed(0) : 50;

            this.updateElement('tradesPerSecond', this.tradesPerSecond.toString());
            this.updateElement('avgTradeSize', `${avgSize.toFixed(3)} BTC`);
            this.updateElement('buyVsSell', `${buyPercent}/${sellPercent}`);
            this.updateElement('totalTrades', this.tradeCount.toLocaleString());
        }

        pauseUpdates() {
            this.isRunning = !this.isRunning;
            const btn = document.getElementById('pauseBtn');
            if (btn) {
                btn.textContent = this.isRunning ? '⏸️' : '▶️';
            }
            
            const message = this.isRunning ? '▶️ Time & Sales resumed' : '⏸️ Time & Sales paused';
            this.showNotification(message);
        }

        exportTrades() {
            let filteredTrades = this.trades;
            
            if (this.exchangeFilter !== 'all') {
                filteredTrades = filteredTrades.filter(t => t.exchange.toLowerCase() === this.exchangeFilter);
            }
            
            if (this.sizeFilter !== 'all' && this.sizeFilter > 0) {
                filteredTrades = filteredTrades.filter(t => t.size >= this.sizeFilter);
            }
            
            const data = {
                timestamp: new Date().toISOString(),
                filters: {
                    exchange: this.exchangeFilter,
                    minSize: this.sizeFilter
                },
                trades: filteredTrades.slice(0, 2000), // Export last 2000 filtered trades
                stats: {
                    totalTrades: this.tradeCount,
                    tradesPerSecond: this.tradesPerSecond,
                    totalVolume: this.totalVolume,
                    buyCount: this.buyCount,
                    sellCount: this.sellCount
                }
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `time-sales-${this.exchangeFilter}-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            this.showNotification(`💾 Exported ${filteredTrades.length} trades`);
        }

        updateElement(id, value) {
            const el = document.getElementById(id);
            if (el) el.textContent = value;
        }

        showNotification(message) {
            console.log(message);
            // Use the existing notification system from VolumeAnalytics
            if (window.volumeAnalytics) {
                window.volumeAnalytics.showNotification(message);
            }
        }
    }

    // Global references for external access
    window.WhaleWatcher = WhaleWatcher;
    window.TimeSales = TimeSales;

    // Auto-initialize whale watcher and time & sales when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
            if (document.getElementById('whaleTradesList')) {
                window.whaleWatcher = new WhaleWatcher();
            }
            if (document.getElementById('timeSalesList')) {
                window.timeSales = new TimeSales();
            }
            console.log('🐋⏰ Whale Watcher and Time & Sales systems ready!');
        }, 1000);
    });

    // Add CSS animations and styles for whale watcher and time & sales
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        /* Whale Watcher Styles */
        .whale-content {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .whale-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .whale-stat {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.05);
            padding: 16px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-icon {
            font-size: 24px;
            width: 40px;
            text-align: center;
        }
        
        .stat-info {
            flex: 1;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: 600;
            color: #4facfe;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #a0a0a0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .whale-trades-container, .time-sales-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .whale-trade-header, .time-sales-header {
            display: grid;
            grid-template-columns: 80px 100px 60px 100px 100px 120px;
            gap: 8px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            font-size: 12px;
            font-weight: 600;
            color: #b0b0b0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .whale-trades-list, .time-sales-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .whale-trade, .time-sales-trade {
            display: grid;
            grid-template-columns: 80px 100px 60px 100px 100px 120px;
            gap: 8px;
            padding: 8px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 12px;
            transition: background 0.2s ease;
        }
        
        .whale-trade:hover, .time-sales-trade:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .whale-trade.new, .time-sales-trade.new {
            background: rgba(79, 172, 254, 0.1);
            animation: highlightTrade 2s ease-out;
        }
        
        @keyframes highlightTrade {
            0% { background: rgba(79, 172, 254, 0.3); }
            100% { background: rgba(79, 172, 254, 0.1); }
        }
        
        .trade-time {
            color: #a0a0a0;
            font-family: 'Courier New', monospace;
        }
        
        .trade-exchange {
            color: #4facfe;
            font-weight: 600;
        }
        
        .trade-side {
            font-weight: 600;
        }
        
        .trade-side.buy {
            color: #26de81;
        }
        
        .trade-side.sell {
            color: #ff4757;
        }
        
        .trade-size {
            color: #e0e0e0;
            font-weight: 600;
        }
        
        .trade-price {
            color: #ffa502;
            font-family: 'Courier New', monospace;
        }
        
        .trade-value {
            color: #e0e0e0;
            font-weight: 500;
        }
        
        .whale-controls, .time-sales-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .whale-controls select, .time-sales-controls select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #e0e0e0;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
        }
        
        /* Time & Sales Styles */
        .time-sales-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .sales-stat {
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sales-stat .stat-value {
            font-size: 18px;
            font-weight: 600;
            color: #4facfe;
            margin-bottom: 4px;
        }
        
        .sales-stat .stat-label {
            font-size: 11px;
            color: #a0a0a0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Scrollbar Styles */
        .whale-trades-list::-webkit-scrollbar,
        .time-sales-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .whale-trades-list::-webkit-scrollbar-track,
        .time-sales-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .whale-trades-list::-webkit-scrollbar-thumb,
        .time-sales-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        
        .whale-trades-list::-webkit-scrollbar-thumb:hover,
        .time-sales-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .whale-trade-header, .time-sales-header,
            .whale-trade, .time-sales-trade {
                grid-template-columns: 60px 80px 50px 80px 80px 100px;
                font-size: 11px;
            }
            
            .whale-stats, .time-sales-stats {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
    `;
    document.head.appendChild(style);

            this.updateWhaleStats();
            this.showNotification('🗑️ Whale trades cleared');
        }

        updateElement(id, value) {
            const el = document.getElementById(id);
            if (el) el.textContent = value;
        }

        showNotification(message) {
            // Use the existing notification system
            if (window.volumeAnalytics) {
                window.volumeAnalytics.showNotification(message);
            }
        }
    }

    // ⏰ Time & Sales Implementation
    class TimeSales {
        constructor() {
            this.trades = [];
            this.isRunning = true;
            this.exchangeFilter = 'all';
            this.sizeFilter = 'all';
            this.tradesPerSecond = 0;
            this.tradeCount = 0;
            this.init();
        }

        init() {
            console.log('⏰ Initializing Time & Sales...');
            this.bindEvents();
            this.startTradeGeneration();
            this.startStatsUpdater();
        }

        bindEvents() {
            const exchangeFilter = document.getElementById('exchangeFilter');
            if (exchangeFilter) {
                exchangeFilter.addEventListener('change', (e) => {
                    this.exchangeFilter = e.target.value;
                    this.updateTradeDisplay();
                });
            }

            const sizeFilter = document.getElementById('sizeFilter');
            if (sizeFilter) {
                sizeFilter.addEventListener('change', (e) => {
                    this.sizeFilter = parseFloat(e.target.value) || 0;
                    this.updateTradeDisplay();
                });
            }
        }

        startTradeGeneration() {
            const generateTrade = () => {
                if (this.isRunning) {
                    // Generate 1-5 trades at once
                    const numTrades = Math.floor(Math.random() * 5) + 1;
                    for (let i = 0; i < numTrades; i++) {
                        this.generateTradeData();
                    }
                }
                setTimeout(generateTrade, Math.random() * 2000 + 500);
            };
            generateTrade();
        }

        generateTradeData() {
            const exchanges = ['Binance', 'Bybit', 'OKX', 'Kraken', 'Uniswap'];
            const sides = ['BUY', 'SELL'];
            
            const size = Math.random() * 50 + 0.1; // 0.1 to 50 BTC
            const price = 44700 + (Math.random() - 0.5) * 100;
            const value = size * price;
            
            const trade = {
                id: Date.now() + Math.random(),
                time: new Date(),
                exchange: exchanges[Math.floor(Math.random() * exchanges.length)],
                side: sides[Math.floor(Math.random() * sides.length)],
                size: size,
                price: price,
                value: value,
                isNew: true
            };

            this.trades.unshift(trade);
            this.tradeCount++;

            // Keep only last 500 trades
            if (this.trades.length > 500) {
                this.trades.splice(500);
            }

            this.updateTradeDisplay();
        }

        updateTradeDisplay() {
            const container = document.getElementById('timeSalesList');
            if (!container) return;

            // Filter trades
            let filteredTrades = this.trades;
            
            if (this.exchangeFilter !== 'all') {
                filteredTrades = filteredTrades.filter(t => t.exchange.toLowerCase() === this.exchangeFilter);
            }
            
            if (this.sizeFilter !== 'all' && this.sizeFilter > 0) {
                filteredTrades = filteredTrades.filter(t => t.size >= this.sizeFilter);
            }

            // Clear existing trades
            container.innerHTML = '';

            // Display filtered trades (last 100)
            filteredTrades.slice(0, 100).forEach(trade => {
                const tradeEl = document.createElement('div');
                tradeEl.className = `time-sales-trade ${trade.isNew ? 'new' : ''}`;
                
                tradeEl.innerHTML = `
                    <span class="trade-time">${trade.time.toLocaleTimeString()}</span>
                    <span class="trade-exchange">${trade.exchange}</span>
                    <span class="trade-side ${trade.side.toLowerCase()}">${trade.side}</span>
                    <span class="trade-size">${trade.size.toFixed(3)}</span>
                    <span class="trade-price">$${trade.price.toFixed(2)}</span>
                    <span class="trade-value">$${(trade.value / 1000).toFixed(1)}K</span>
                `;
                
                container.appendChild(tradeEl);
                
                // Remove new class after animation
                if (trade.isNew) {
                    setTimeout(() => {
                        trade.isNew = false;
                        tradeEl.classList.remove('new');
                    }, 1500);
                }
            });
        }

        startStatsUpdater() {
            let lastTradeCount = 0;
            
            setInterval(() => {
                // Calculate trades per second
                const currentTradeCount = this.tradeCount;
                this.tradesPerSecond = currentTradeCount - lastTradeCount;
                lastTradeCount = currentTradeCount;
                
                this.updateStats();
            }, 1000);
        }

        updateStats() {
            const recentTrades = this.trades.slice(0, 100);
            const avgSize = recentTrades.length > 0 ? 
                recentTrades.reduce((sum, t) => sum + t.size, 0) / recentTrades.length : 0;
            
            const buyTrades = recentTrades.filter(t => t.side === 'BUY').length;
            const sellTrades = recentTrades.filter(t => t.side === 'SELL').length;
            const total = buyTrades + sellTrades;
            const buyPercent = total > 0 ? (buyTrades / total * 100).toFixed(0) : 50;
            const sellPercent = total > 0 ? (sellTrades / total * 100).toFixed(0) : 50;

            this.updateElement('tradesPerSecond', this.tradesPerSecond.toString());
            this.updateElement('avgTradeSize', `${avgSize.toFixed(2)} BTC`);
            this.updateElement('buyVsSell', `${buyPercent}/${sellPercent}`);
            this.updateElement('totalTrades', this.tradeCount.toString());
        }

        pauseUpdates() {
            this.isRunning = !this.isRunning;
            const btn = document.getElementById('pauseBtn');
            if (btn) {
                btn.textContent = this.isRunning ? '⏸️' : '▶️';
            }
            
            const message = this.isRunning ? '▶️ Time & Sales resumed' : '⏸️ Time & Sales paused';
            this.showNotification(message);
        }

        exportTrades() {
            const data = {
                timestamp: new Date().toISOString(),
                filters: {
                    exchange: this.exchangeFilter,
                    minSize: this.sizeFilter
                },
                trades: this.trades.slice(0, 1000), // Export last 1000 trades
                stats: {
                    totalTrades: this.tradeCount,
                    tradesPerSecond: this.tradesPerSecond
                }
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `time-sales-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            this.showNotification('💾 Time & Sales data exported');
        }

        updateElement(id, value) {
            const el = document.getElementById(id);
            if (el) el.textContent = value;
        }

        showNotification(message) {
            if (window.volumeAnalytics) {
                window.volumeAnalytics.showNotification(message);
            }
        }
    }

    // Global references
    window.WhaleWatcher = WhaleWatcher;
    window.TimeSales = TimeSales;

    // Initialize whale watcher and time & sales when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
            window.whaleWatcher = new WhaleWatcher();
            window.timeSales = new TimeSales();
            console.log('🐋⏰ Whale Watcher and Time & Sales initialized!');
        }, 2000);
    });

    // Add CSS animations and styles for whale watcher and time & sales
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        /* Whale Watcher Styles */
        .whale-content {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .whale-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .whale-stat {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.05);
            padding: 16px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-icon {
            font-size: 24px;
            width: 40px;
            text-align: center;
        }
        
        .stat-info {
            flex: 1;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: 600;
            color: #4facfe;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #a0a0a0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .whale-trades-container, .time-sales-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .whale-trade-header, .time-sales-header {
            display: grid;
            grid-template-columns: 80px 100px 60px 100px 100px 120px;
            gap: 8px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            font-size: 12px;
            font-weight: 600;
            color: #b0b0b0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .whale-trades-list, .time-sales-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .whale-trade, .time-sales-trade {
            display: grid;
            grid-template-columns: 80px 100px 60px 100px 100px 120px;
            gap: 8px;
            padding: 8px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 12px;
            transition: background 0.2s ease;
        }
        
        .whale-trade:hover, .time-sales-trade:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .whale-trade.new, .time-sales-trade.new {
            background: rgba(79, 172, 254, 0.1);
            animation: highlightTrade 2s ease-out;
        }
        
        @keyframes highlightTrade {
            0% { background: rgba(79, 172, 254, 0.3); }
            100% { background: rgba(79, 172, 254, 0.1); }
        }
        
        .trade-time {
            color: #a0a0a0;
            font-family: 'Courier New', monospace;
        }
        
        .trade-exchange {
            color: #4facfe;
            font-weight: 600;
        }
        
        .trade-side {
            font-weight: 600;
        }
        
        .trade-side.buy {
            color: #26de81;
        }
        
        .trade-side.sell {
            color: #ff4757;
        }
        
        .trade-size {
            color: #e0e0e0;
            font-weight: 600;
        }
        
        .trade-price {
            color: #ffa502;
            font-family: 'Courier New', monospace;
        }
        
        .trade-value {
            color: #e0e0e0;
            font-weight: 500;
        }
        
        .whale-controls, .time-sales-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .whale-controls select, .time-sales-controls select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #e0e0e0;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
        }
        
        /* Time & Sales Styles */
        .time-sales-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .sales-stat {
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sales-stat .stat-value {
            font-size: 18px;
            font-weight: 600;
            color: #4facfe;
            margin-bottom: 4px;
        }
        
        .sales-stat .stat-label {
            font-size: 11px;
            color: #a0a0a0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Scrollbar Styles */
        .whale-trades-list::-webkit-scrollbar,
        .time-sales-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .whale-trades-list::-webkit-scrollbar-track,
        .time-sales-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .whale-trades-list::-webkit-scrollbar-thumb,
        .time-sales-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        
        .whale-trades-list::-webkit-scrollbar-thumb:hover,
        .time-sales-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .whale-trade-header, .time-sales-header,
            .whale-trade, .time-sales-trade {
                grid-template-columns: 60px 80px 50px 80px 80px 100px;
                font-size: 11px;
            }
            
            .whale-stats, .time-sales-stats {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
    `;
    document.head.appendChild(style);
    </script>

    <script type="module" src="volume-dashboard.tsx"></script>
</body>
</html> 